{% extends "staff_panel/panel.html" %}

{% block page_title %}{{ meeting.title }}{% endblock %}

{% block action_buttons %}
  <a href="{% url 'staff_meeting_list'  %}" class="header-btn">← Back to Meeting</a>
{% endblock %}

{% block main_content %}
<div class="row">
  <div class="col-md-6">
    <!-- 🗓 Meeting Info -->
	<div class="card mb-4">
		<div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
			<span>🗓 Meeting Info</span>
			<a href="#" class="btn btn-sm btn-light">✏️ Edit</a>
		</div>
		<div class="card-body">
		<p><strong>Date:</strong> {{ meeting.date|date:"Y/m/d H:i" }}</p>
		<p><strong>Type:</strong> {{ meeting.get_meeting_type_display }}</p>
		<p><strong>Status:</strong> {{ meeting.get_status_display }}</p>
		<p><strong>Location:</strong> {{ meeting.location|default:"—" }}</p>
		{% if meeting.online_link %}
			<p><strong>Online Link:</strong> <a href="{{ meeting.online_link }}" target="_blank">{{ meeting.online_link }}</a></p>
		{% endif %}
		</div>
	</div>
  </div>
  <div class="col-md-6">
    <!-- 📋 Agenda Items -->
	<div class="card mb-4">
	<div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
		<span>📋 Agenda Items</span>
		<a href="{% url 'agenda_create' meeting.pk %}" class="btn btn-sm btn-light">➕ New</a>
	</div>
	<div class="table-responsive">
		{% if agenda_items %}
		<table class="table table-bordered table-hover">
			<thead class="table-light">
			<tr>
				<th>#</th>
				<th>Title</th>
				<th>Order</th>
				<th>Description</th>
				<th>File</th>
				<th>Vote?</th>
				<th>Actions</th>
			</tr>
			</thead>
			<tbody>
			{% for item in agenda_items %}
			<tr>
				<td>{{ forloop.counter }}</td>
				<td>{{ item.title }}</td>
				<td>{{ item.order }}</td>
				<td>{{ item.description|default:"No description." }}</td>
				<td>
				{% if item.file %}
					<a href="{{ item.file.url }}" target="_blank">📎 File</a>
				{% else %}
					—
				{% endif %}
				</td>
				<td>{% if item.requires_vote %}✔️{% else %}—{% endif %}</td>
				<td>
				<a href="{% url 'agenda_edit' item.pk %}" class="btn btn-sm btn-outline-primary">✏️</a>
				<a href="{% url 'agenda_delete' item.pk %}" class="btn btn-sm btn-outline-danger">🗑️</a>
				</td>
			</tr>
			{% endfor %}
			</tbody>
		</table>
		{% else %}
		<p>No agenda items recorded.</p>
		{% endif %}
	</div>
	</div>	
  </div>
</div>

<div class="row">
  <div class="col-md-6">
    <!-- 👥 Invitees -->
	<div class="card mb-4">
		<div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
			<span>👥 Invitees</span>
			<a href="{% url 'invite_create' meeting.pk %}" class="btn btn-sm btn-light">➕ New</a>
		</div>
		<div class="card-body">
			{% if invitees %}
			<div class="table-responsive">
				<table class="table table-bordered table-hover">
				<thead class="table-light">
					<tr>
					<th>#</th>	
					<th>Name</th>
					<th>Status</th>
					<th>Responded At</th>
					<th>Actions</th>
					</tr>
				</thead>
				<tbody>
					{% for invite in invitees %}
					<tr>
					<td>{{ forloop.counter }}</td>
					<td>{{ invite.invited_user.get_full_name }}</td>
					<td><strong>{{ invite.get_status_display }}</strong></td>
					<td>
						{% if invite.responded_at %}
						{{ invite.responded_at|date:"Y/m/d H:i" }}
						{% else %}
						—
						{% endif %}
					</td>
					<td>
						<a href="{% url 'invite_edit' invite.pk %}" class="btn btn-sm btn-outline-primary">✏️</a>
						<a href="{% url 'invite_delete' invite.pk %}" class="btn btn-sm btn-outline-danger">🗑️</a>
					</td>
					</tr>
					{% endfor %}
				</tbody>
				</table>
			</div>
			{% else %}
			<p>No invitees listed.</p>
			{% endif %}
		</div>
  	</div>
  </div>
  <div class="col-md-6">
	<!-- 📄 Minutes -->
	<div class="card mb-4">
		<div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
			<span>📄 Minutes</span>
			<a href="#" class="btn btn-sm btn-light">➕ New</a>
		</div>
		<div class="card-body">
		{% if minutes %}
			<p><strong>Status:</strong> {{ minutes.get_status_display }}</p>
			<p><strong>Summary:</strong> {{ minutes.summary }}</p>
			{% if minutes.body %}
			<p>{{ minutes.body|linebreaks }}</p>
			{% endif %}
			{% if minutes.file %}
			<p><a href="{{ minutes.file.url }}" target="_blank">📎 Download Minutes File</a></p>
			{% endif %}
			<p><small>Recorded by: {{ minutes.recorded_by.get_full_name|default:"—" }}</small></p>
			{% if minutes.approved_by %}
			<p><small>Approved by: {{ minutes.approved_by.get_full_name }} at {{ minutes.approved_at|date:"Y/m/d H:i" }}</small></p>
			{% endif %}
		{% else %}
			<p>No minutes recorded.</p>
		{% endif %}
		</div>
	</div>
  </div>
</div>
  
<!-- 📌 Motions & Votes -->
<div class="row">
  <div class="col-12">
    <div class="card mb-4">
      <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
		<span>📌 Motions & Votes</span>
		<a href="#" class="btn btn-sm btn-outline-dark">➕ New</a>
	  </div>
      <div class="card-body">
        {% if motions %}
          {% for motion in motions %}
            <div class="border rounded p-2 mb-3">
              <strong>{{ motion.text }}</strong><br>
              <small>Agenda: {{ motion.agenda_item.title }}</small><br>
              <small>Proposed by: {{ motion.created_by.get_full_name|default:"—" }}</small><br>

              {% with votes=votes_by_motion.motion.id %}
                {% if votes %}
                  <ul class="mt-2">
                    {% for vote in votes %}
                      <li>{{ vote.voter.get_full_name }} voted <strong>{{ vote.get_choice_display }}</strong> at {{ vote.voted_at|date:"Y/m/d H:i" }}</li>
                    {% endfor %}
                  </ul>
                {% else %}
                  <p>No votes recorded for this motion.</p>
                {% endif %}
              {% endwith %}
            </div>
          {% endfor %}
        {% else %}
          <p>No motions proposed.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% endblock %}
