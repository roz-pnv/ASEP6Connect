{% extends "staff_panel/panel.html" %}
{% load static %}

{% block page_title %}
üìù {{ motion_title }}
{% endblock %}

{% block action_buttons %}
<a href="{% url 'staff_meeting_detail' motion.agenda_item.meeting.pk %}" class="header-btn">‚Üê Back to Meeting</a>
{% endblock %}

{% block main_content %}
<div class="row">
  <div class="col-md-12">
    <!-- üìù Motion Info -->
    <div class="card mb-4">
      <div class="card-header text-white" style="background-color: #7e57c2;">
        üìù Motion Info
      </div>
      <div class="card-body">
        <p><strong>Text:</strong> {{ motion.text }}</p>
        <p><strong>Agenda Item:</strong> {{ motion.agenda_item.title }}</p>
        <p><strong>Proposed By:</strong> {{ motion.created_by.get_full_name|default:"‚Äî" }}</p>
        <p><strong>Created At:</strong> {{ motion.created_at|date:"Y/m/d H:i" }}</p>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <!-- üìä Vote Summary -->
  <div class="col-md-4">
    <div class="card mb-4">
      <div class="card-header text-white" style="background-color: #ec407a;">
        üìä Vote Summary
      </div>
      <div class="card-body text-center">
		<div class="chart-container">
			<canvas id="voteChart{{ motion.id }}"></canvas>
		</div>
		<div class="mt-3">
			<p><strong>Yes:</strong> {{ vote_yes }}</p>
			<p><strong>No:</strong> {{ vote_no }}</p>
			<p><strong>Abstain:</strong> {{ vote_abstain }}</p>
		</div>
	   </div>
    </div>
  </div>

  <!-- üó≥Ô∏è Vote Details -->
  <div class="col-md-8">
    <div class="card mb-4">
      <div class="card-header text-white" style="background-color: #ab47bc;">
        üó≥Ô∏è Vote Details
      </div>
      <div class="table-responsive">
        <table class="table table-striped table-bordered align-middle">
          <thead class="table-light">
            <tr class="text-center">
              <th>#</th>
              <th>Voter</th>
              <th>Username</th>
              <th>Email</th>
              <th>Choice</th>
              <th>Voted At</th>
            </tr>
          </thead>
          <tbody>
            {% for vote in votes %}
            <tr>
              <td class="text-center">{{ forloop.counter }}</td>
              <td>{{ vote.voter.get_full_name }}</td>
              <td>{{ vote.voter.username }}</td>
              <td>{{ vote.voter.email }}</td>
              <td class="text-center"><span class="badge bg-secondary">{{ vote.get_choice_display }}</span></td>
              <td>{{ vote.voted_at|date:"Y/m/d H:i" }}</td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="6" class="text-center text-muted">No votes recorded yet.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- ‚úÖ Load Chart.js and external script -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  window.motionChartData = [{
    id: {{ motion.id}},
    vote_yes: {{ vote_yes|default:"0" }},
    vote_no: {{ vote_no|default:"0" }},
    vote_abstain: {{ vote_abstain|default:"0" }}
  }];
</script>
<script src="{% static 'js/motion_chart.js' %}"></script>
{% endblock %}
