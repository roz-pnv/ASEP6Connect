{% extends "staff_panel/panel.html" %}

{% block page_title %}👥 User Management{% endblock %}

{% block action_buttons %}
<div class="d-flex flex-wrap gap-2 justify-content-between align-items-center">
  <a href="{% url 'user_add' %}" class="header-btn">➕ Add User</a>
  <button id="toggleFilter" class="header-btn">🔍 Filter</button>
</div>
{% endblock %}


{% block main_class %}with-sidebar{% endblock %}

{% block main_content %}
<div class="table-responsive">
  <table class="table table-hover align-middle purple-table w-100">
    <thead class="table-purple">
      <tr>
        <th>#</th>
        <th>Username</th>
        <th>Full Name</th>
        <th>Email</th>
        <th>Student</th>
        <th>Board Member</th>
        <th>Country</th>
      </tr>
    </thead>
    <tbody>
      {% for user in users %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>
          <a href="{% url 'user_detail' user.id %}">{{ user.username }}</a>
        </td>
        <td>{{ user.get_full_name }}</td>
        <td>{{ user.email }}</td>
        <td>
          {% if user.is_student %}
            <span class="badge bg-info">Yes</span>
          {% else %}
            <span class="badge bg-secondary">No</span>
          {% endif %}
        </td>
        <td>
          {% if user.is_boardofdirector %}
            <span class="badge bg-warning text-dark">Yes</span>
          {% else %}
            <span class="badge bg-light text-muted">No</span>
          {% endif %}
        </td>
        <td>{{ user.country_of_origin.name|default:"—" }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="11" class="text-center text-muted">No users found.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

{% block right_sidebar %}
<aside class="sidebar sidebar-right">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="mb-0">🔎 Filter Users</h4>
    <button id="closeFilter" class="btn btn-sm btn-outline-danger" title="Close">✖</button>
  </div>
  <form method="get" class="d-grid gap-3">
    <input type="text" name="q" class="form-control" placeholder="Search username or email" value="{{ request.GET.q }}">

    <select name="role" class="form-select">
      <option value="">All Roles</option>
      {% for value, label in role_types %}
        <option value="{{ value }}" {% if request.GET.role == value %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>

    <select name="member_type" class="form-select">
      <option value="">All Member Types</option>
      {% for value, label in member_types %}
        <option value="{{ value }}" {% if request.GET.member_type == value %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>

    <select name="country" class="form-select">
      <option value="">All Countries</option>
      {% for c in countries %}
        <option value="{{ c.name }}" {% if request.GET.country == c.name %}selected{% endif %}>{{ c.name }}</option>
      {% endfor %}
    </select>

    <div class="col-auto">
      <label for="joined_after">Joined After</label>
      <input type="date" name="joined_after" class="form-control" value="{{ request.GET.joined_after }}">
    </div>

    <div class="col-auto">
      <label for="joined_before">Joined Before</label>
      <input type="date" name="joined_before" class="form-control" value="{{ request.GET.joined_before }}">
    </div>

    <select name="is_student" class="form-select">
      <option value="">All Users</option>
      <option value="true" {% if request.GET.is_student == "true" %}selected{% endif %}>Students Only</option>
      <option value="false" {% if request.GET.is_student == "false" %}selected{% endif %}>Non-Students Only</option>
    </select>

    <div class="d-grid gap-2">
      <button type="submit" class="btn btn-primary">Apply Filters</button>
      <a href="{% url 'user_list' %}" class="btn btn-outline-secondary">Reset</a>
    </div>
  </form>
</aside>
{% endblock %}
